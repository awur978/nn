/*
 * Neural Network library
 * Copyright (c) 2019 Cole Design and Development, LLC
 * https://coledd.com
 * SPDX-License-Identifier: Apache-2.0
 */

#include <stdio.h>
#include "nn.h"

// Show a graphical representation of the input data
void show_input(float *input)
{
	for (int i=0; i<16; i++) {
		for (int j=0; j<16; j++) {
			if ((input[i*16+j])>0)
				printf("1");
			else
				printf("0");
		}
		printf("\n");
	}
}

int main(void)
{
	nn_t *model;

	// Test data upon which to make a prediction
	float in[3][256]={
	{
		0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,
		0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,
		0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,
		0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,
		0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,
		0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,
		0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,
		0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,
		0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,
		0,1,1,0,0,0,0,1,1,1,1,1,1,1,0,0,
		0,1,1,0,0,1,1,1,0,0,0,0,0,1,1,0,
		1,1,0,1,1,1,0,0,0,0,0,0,0,1,0,0,
		1,1,0,0,0,0,0,0,0,0,0,1,1,1,0,0,
		1,1,0,0,0,0,0,0,0,0,1,1,1,0,0,0,
		1,1,1,1,0,0,1,1,1,1,1,0,0,0,0,0,
		0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,
	},{
		1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,
		1,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,
		0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,
		0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,
		0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,
		0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,
		0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,
		0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,
		0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,
		0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,
		0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,
		0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,
		0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,
		0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,
		0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,
		0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,
	},{
		0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
		0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,
		0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,
		0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,
		0,0,1,1,1,0,0,0,0,0,0,0,0,1,1,1,
		0,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,
		0,1,1,1,0,0,0,0,0,0,0,0,1,1,1,1,
		0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,
		0,1,0,0,0,0,0,0,0,0,1,1,1,0,0,0,
		0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,
		0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,
		0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,
		0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,
		0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,
		0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,
		0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,
	}
	};
	// Recall a previously trained neural network model, inclusive of its weights
	model=nn_load("model.txt");
	if (NULL==model) {
		printf("Error: Missing or invalid model file.\n");
		return 1;
	}
	for (int i=0; i<3; i++) {
		show_input(in[i]);
		// Make an output prediction based upon new input data
		float *prediction=nn_predict(model, in[i]);
		int max=0;
		for (int j=0; j<10; j++) {
			printf("%.5f ", prediction[j]);
			if (prediction[j]>prediction[max])
				max=j;
		}
		printf("--> %d (%.1f%%)\n", max, prediction[max]*100);
	}
	nn_free(model);
	return 0;
}

